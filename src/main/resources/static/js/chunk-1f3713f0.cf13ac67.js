(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1f3713f0"],{"0a90":function(t,e,a){var i=a("63b6"),s=a("10ff");i(i.G+i.F*(parseFloat!=s),{parseFloat:s})},"10ff":function(t,e,a){var i=a("e53d").parseFloat,s=a("a1ce").trim;t.exports=1/i(a("e692")+"-0")!==-1/0?function(t){var e=s(String(t),3),a=i(e);return 0===a&&"-"==e.charAt(0)?-0:a}:i},"27b8":function(t,e,a){"use strict";var i=a("8eec"),s=a.n(i);s.a},"2fdb":function(t,e,a){"use strict";var i=a("5ca1"),s=a("d2c8"),o="includes";i(i.P+i.F*a("5147")(o),"String",{includes:function(t){return!!~s(this,t,o).indexOf(t,arguments.length>1?arguments[1]:void 0)}})},"4ed9":function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{attrs:{id:"loginFrame"}},[t._m(0),a("div",{attrs:{id:"login"}},[t.show?a("b-form",{on:{submit:t.onSubmit,reset:t.onReset}},[a("b-form-group",{attrs:{id:"userId",label:"ID:","label-for":"userIdInput"}},[a("b-form-input",{attrs:{id:"userIdInput",type:"text",required:"",placeholder:"输入ID"},model:{value:t.form.userId,callback:function(e){t.$set(t.form,"userId",e)},expression:"form.userId"}})],1),a("b-form-group",{attrs:{id:"password",label:"密码:","label-for":"passwordInput"}},[a("b-form-input",{attrs:{id:"passwordInput",type:"password",required:"",placeholder:"输入密码"},model:{value:t.form.password,callback:function(e){t.$set(t.form,"password",e)},expression:"form.password"}})],1),a("div",{attrs:{id:"loginStatus"}},[a("span",[t._v(t._s(t.loginStatus))])]),a("b-button",{staticClass:"sub-btn",class:{disabled:t.hasClicked},attrs:{type:"submit",variant:"primary",size:"md"}},[t._v("登陆\n        ")]),a("b-button",{staticClass:"sub-btn",class:{disabled:t.hasClicked},attrs:{type:"reset",variant:"danger",size:"md"}},[t._v("重置\n        ")])],1):t._e()],1)])])},s=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"title"}},[a("h3",[t._v("用户登录")])])}],o=a("f499"),n=a.n(o),r=(a("6b54"),a("96cf"),a("3b8d")),l=a("c0d6"),c={data:function(){return{form:{userId:"",password:""},loginStatus:"",show:!0,hasClicked:!1}},methods:{onSubmit:function(t){var e=this;if(t.preventDefault(),!this.hasClicked){var a=/[0-9]+/;a.test(this.form.userId)?(this.hasClicked=!0,this.loginStatus="登陆中...",this.login().then(function(t){100===t?(e.loginStatus="登陆成功",e.fetchData(),e.form.userId="",e.form.password="",e.loginStatus="",e.hasClicked=!1):500===t?(e.loginStatus="账户尚未激活",e.hasClicked=!1,e.$router.push({name:"activate"})):210===t?(e.loginStatus="请求超时，请重试",e.hasClicked=!1):-999===t?(e.loginStatus="服务器开小差了，请重试",e.hasClicked=!1):(e.loginStatus="ID或密码不正确",e.hasClicked=!1)})):this.loginStatus="ID必须为数字"}},onReset:function(t){var e=this;t.preventDefault(),this.hasClicked||(this.form.userId="",this.form.password="",this.loginStatus="",this.show=!1,this.$nextTick(function(){e.show=!0}))},login:function(){var t=Object(r["a"])(regeneratorRuntime.mark(function t(){var e,a;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return e={userId:this.form.userId,password:this.form.password},a=200,t.next=4,this.axios.post(this.getAPI()+"/login",e,{timeout:15e3}).then(function(t){console.log(t.data),a=t.data},function(t){"ECONNABORTED"===t.code&&-1!==t.toString().indexOf("timeout")?a=210:(console.log("post failed"),console.log(t))});case 4:return t.abrupt("return",a);case 5:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),fetchData:function(){this.axios.get(this.getAPI()+"/user").then(function(t){localStorage.setItem("user",n()(t.data)),l["a"].commit("setUser")},function(t){console.log("post failed"),console.log(t)})}}},d=c,u=(a("27b8"),a("2877")),p=Object(u["a"])(d,i,s,!1,null,"f1f5a078",null);e["a"]=p.exports},5147:function(t,e,a){var i=a("2b4c")("match");t.exports=function(t){var e=/./;try{"/./"[t](e)}catch(a){try{return e[i]=!1,!"/./"[t](e)}catch(s){}}return!0}},"52f9":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[t._m(0),t._m(1),a("div",{attrs:{id:"geo-fence-setting"}},[a("div",{staticClass:"row"},[a("div",{staticClass:"col-11"},[a("div",{staticClass:"amap-wrapper"},[a("el-amap-search-box",{staticClass:"search-box",attrs:{"on-search-result":t.onSearchResult}}),a("el-amap",{staticClass:"amap-box",attrs:{vid:"amap-vue",plugin:t.mapView.plugin,center:t.mapView.mapCenter,zoom:t.mapView.zoom,"amap-manager":t.amapManager}},[t._l(t.mapView.markers,function(t){return a("el-amap-marker",{attrs:{position:t}})}),a("el-amap-polygon",{ref:"polygon_0",attrs:{path:t.mapView.polygon.path,editable:t.mapView.polygon.editable,events:t.mapView.polygon.events,draggable:t.mapView.polygon.editable,fillOpacity:"0.3",fillColor:"blue",strokeOpacity:"0.6",strokeColor:"pink",zIndex:"50",visible:t.mapView.polygon.visible}})],2)],1),a("div",{staticClass:"col-1"})])]),a("div",{staticClass:"row"},[a("div",{staticClass:"col-4"},[a("div",{staticClass:"map-toolbar"},[t.disableClk?t._e():[a("button",{staticClass:"btn btn-primary",attrs:{type:"button"},on:{click:t.addGeoFence}},[t._v("添加围栏")])],t.disableClk?[a("button",{staticClass:"btn btn-info",attrs:{type:"button"},on:{click:t.getGeoFence}},[t._v("刷新围栏")]),a("button",{staticClass:"btn btn-success",attrs:{type:"button"},on:{click:t.modifyGeoFence}},[t._v("修改围栏")]),a("button",{staticClass:"btn btn-danger",attrs:{type:"button"},on:{click:t.deleteGeoFence}},[t._v("删除围栏")])]:t._e()],2)]),a("div",{staticClass:"col-4"},[a("div",{staticClass:"status-info"},[t._v(t._s(t.operationStatus))])]),a("div",{staticClass:"col-3"},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.showSubmit,expression:"showSubmit"}],staticClass:"map-toolbar",staticStyle:{float:"right"}},[a("button",{staticClass:"btn btn-primary",attrs:{type:"button"},on:{click:t.submitGeoFence}},[t._v("提交")]),a("button",{staticClass:"btn btn-danger",attrs:{type:"button"},on:{click:t.dismissAction}},[t._v("取消")])])]),a("div",{staticClass:"col-1"})]),t._m(2),a("div",{attrs:{id:"geo-fence-info"}},[a("div",{staticClass:"row"},[a("div",{staticClass:"col-12"},[t._v("\n          "+t._s(t.geoFence.name)),a("br"),t._v("\n          "+t._s(t.geoFence.valid_time)),a("br"),t._v("\n          "+t._s(t.geoFence.enable)+"\n        ")])])])]),a("div",{staticClass:"modal",attrs:{tabindex:"-1",role:"dialog",id:"delConfirmModal"}},[a("div",{staticClass:"modal-dialog modal-dialog-centered modal-sm",attrs:{role:"document"}},[a("div",{staticClass:"modal-content"},[t._m(3),t._m(4),a("div",{staticClass:"modal-footer"},[a("button",{staticClass:"btn btn-danger",attrs:{type:"button"},on:{click:t.submitGeoFence}},[t._v("确定")]),a("button",{staticClass:"btn btn-secondary",attrs:{type:"button","data-dismiss":"modal"},on:{click:t.dismissAction}},[t._v("取消")])])])])]),a("div",{staticClass:"modal fade",attrs:{id:"loginModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true"}},[a("div",{staticClass:"modal-dialog modal-dialog-centered modal-md",attrs:{role:"document"}},[a("div",{staticClass:"modal-content"},[t._m(5),a("div",{staticClass:"modal-body",attrs:{id:"loginModalBody"}},[a("LoginModal")],1)])])])])},s=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"row"},[a("div",{staticClass:"col-12"},[a("div",{attrs:{id:"panel-title"}},[a("h4",[a("strong",[t._v("安全设置")])])])])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("label",{attrs:{for:"geo-fence-setting"}},[a("strong",[t._v("设置电子围栏")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("label",{attrs:{for:"geo-fence-info"}},[a("strong",[t._v("电子围栏信息")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"modal-header"},[a("h5",{staticClass:"modal-title"},[t._v("删除确认")]),a("button",{staticClass:"close",attrs:{type:"button","data-dismiss":"modal","aria-label":"Close"}},[a("span",{attrs:{"aria-hidden":"true"}},[t._v("×")])])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"modal-body"},[a("p",[t._v("确认删除围栏？围栏数据不可恢复")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"modal-header"},[a("h5",{staticClass:"modal-title",attrs:{id:"loginModalLabel"}},[t._v("会话超时")]),a("button",{staticClass:"close",attrs:{type:"button","data-dismiss":"modal","aria-label":"Close"}},[a("span",{attrs:{"aria-hidden":"true"}},[t._v("×")])])])}],o=(a("6762"),a("2fdb"),a("59ad")),n=a.n(o),r=(a("ac6a"),a("1157")),l=a.n(r),c=a("4ed9"),d=a("8f9b"),u=a.n(d),p=new u.a.AMapManager,h={name:"secSetting",components:{LoginModal:c["a"]},data:function(){var t=this;return{amapManager:p,mapView:{zoom:14,markers:[],mapCenter:[113.874908,22.902537],lng:0,lat:0,plugin:[{pName:"Geolocation",events:{}},{pName:"OverView",isOpen:!0},{pName:"PolyEditor"}],polygon:{visible:!1,editable:!1,path:[[113.874908,22.902537],[113.879,22.902537],[113.879,22.905],[113.874908,22.905]],events:{click:function(){console.log(t.$refs.polygon_0.$$getPath())}}}},geoFence:{},disableClk:!0,showSubmit:!1,hasClicked:!1,currentAction:-1,gid:"",previousPath:[],operationStatus:""}},computed:{isOnline:function(){return this.$store.getters.getOnline}},watch:{isOnline:function(){this.$store.getters.getOnline&&(l()("#loginModal").modal("hide"),this.getGeoFence())}},methods:{onSearchResult:function(t){var e=this;this.mapView.markers=[];var a=0,i=0;if(t.length>0){t.forEach(function(t){var s=t.lng,o=t.lat;i+=s,a+=o,e.mapView.markers.push([t.lng,t.lat])});var s={lng:i/t.length,lat:a/t.length};this.mapView.mapCenter=[s.lng,s.lat]}},addGeoFence:function(){if(this.operationStatus="",!this.disableClk){var t=p.getMap().getCenter().lng,e=p.getMap().getCenter().lat;this.mapView.mapCenter=[t,e],this.mapView.polygon.path=[[t-.005,e+.005],[t+.005,e+.005],[t+.005,e-.005],[t-.005,e-.005]],this.currentAction=0,this.showSubmit=!0,this.mapView.polygon.visible=!0,this.mapView.polygon.editable=!0}},modifyGeoFence:function(){this.operationStatus="",this.disableClk&&(this.previousPath=this.$refs.polygon_0.$$getPath(),this.currentAction=1,this.showSubmit=!0,this.mapView.polygon.editable=!0)},deleteGeoFence:function(){this.operationStatus="",this.disableClk&&(this.currentAction=2,l()("#delConfirmModal").modal({backdrop:"static"}))},dismissAction:function(){this.operationStatus="",0===this.currentAction?(this.showSubmit=!1,this.mapView.polygon.visible=!1,this.mapView.polygon.editable=!1):1===this.currentAction&&(this.mapView.polygon.path=this.previousPath,this.showSubmit=!1,this.mapView.polygon.editable=!1),this.currentAction=-1},setMapCenter:function(t){this.mapView.mapCenter=[n()(t.substring(0,t.indexOf(","))),n()(t.substring(t.indexOf(",")+1))]},setPolygonPath:function(t){this.mapView.polygon.path=[];var e=[];do{e.push(n()(t.substring(0,t.indexOf(",")))),t=t.substring(t.indexOf(",")+1),t.includes(";")?(e.push(n()(t.substring(0,t.indexOf(";")))),t=t.substring(t.indexOf(";")+1)):e.push(n()(t)),this.mapView.polygon.path.push(e),e=[]}while(t.includes(","))},getPolygonPath:function(){for(var t=this.$refs.polygon_0.$$getPath(),e="",a=0;a<t.length;a++){for(var i=0;i<2;i++)e+=t[a][i],0===i&&(e+=",");if(a+1===t.length)break;e+=";"}return e},checkNumOfPoints:function(){return!(this.$refs.polygon_0.$$getPath().length<3||this.$refs.polygon_0.$$getPath()>5e3)||(alert("围栏点的数量必须大于等于3个小于等于50个(3≤点数≤5000)"),!1)},getGeoFence:function(){var t=this;this.checkSession().then(function(e){e?(t.hasClicked=!0,t.operationStatus="获取围栏中...",t.axios.get("https://restapi.amap.com/v4/geofence/meta?key="+t.getMapKey(),{withCredentials:!1}).then(function(e){0===e.data.data.total_record?(t.operationStatus="暂无围栏",t.disableClk=!1):e.data.data.total_record>0?(t.disableClk=!0,t.mapView.polygon.visible=!0,t.setPolygonPath(e.data.data.rs_list[0].points),t.setMapCenter(e.data.data.rs_list[0].center),t.gid=e.data.data.rs_list[0].gid,p.getMap().setFitView(),t.geoFence=e.data.data.rs_list[0],t.operationStatus="围栏获取成功"):(console.log("获取失败："+e.data.data.message),console.log(e))},function(e){t.operationStatus="请求获取围栏失败",console.log("get geofence failed"),console.log(e)})):l()("#loginModal").modal("show"),t.hasClicked=!1})},submitGeoFence:function(){var t=this;this.hasClicked||(this.hasClicked=!0,this.checkSession().then(function(e){if(e){if(t.mapView.polygon.editable=!1,t.showSubmit=!1,-1===t.currentAction);else if(0===t.currentAction){if(!t.checkNumOfPoints())return void(t.hasClicked=!1);t.operationStatus="正在创建围栏...";var a={name:"ltcGeoFence",points:t.getPolygonPath(),valid_time:"2020-12-31",repeat:"Mon,Tues,Wed,Thur,Fri,Sat,Sun",alert_condition:"enter;leave"};t.axios.post("https://restapi.amap.com/v4/geofence/meta?key="+t.getMapKey(),a,{withCredentials:!1}).then(function(e){"成功"===e.data.data.message?(t.operationStatus="围栏创建成功",console.log("围栏创建成功"),t.gid=e.data.data.gid,p.getMap().setFitView(),t.disableClk=!0):(t.mapView.polygon.visible=!1,t.operationStatus="围栏创建失败: "+e.data.data.message,console.log("围栏创建失败: "+e.data.data.message))},function(e){t.operationStatus="请求失败，围栏创建失败",console.log("网络请求失败"),console.log("围栏创建失败"),console.log(e)})}else if(1===t.currentAction){if(!t.checkNumOfPoints())return void(t.hasClicked=!1);t.operationStatus="正在更新围栏...";var i={name:"ltcGeoFence",points:t.getPolygonPath(),valid_time:"2020-12-31",repeat:"Mon,Tues,Wed,Thur,Fri,Sat,Sun",alert_condition:"enter;leave"};t.axios.patch("https://restapi.amap.com/v4/geofence/meta?key="+t.getMapKey()+"&gid="+t.gid,i,{withCredentials:!1}).then(function(e){"成功"===e.data.data.message?(t.operationStatus="围栏更新成功",p.getMap().setFitView(),console.log("围栏更新成功")):(t.mapView.polygon.path=t.previousPath,t.operationStatus="围栏更新失败: "+e.data.data.message,console.log("围栏更新失败: "+e.data.data.message))},function(e){t.mapView.polygon.path=t.previousPath,t.operationStatus="请求失败，围栏更新失败",console.log("网络请求失败"),console.log("围栏更新失败"),console.log(e)})}else 2===t.currentAction&&(t.operationStatus="正在删除围栏...",l()("#delConfirmModal").modal("hide"),t.axios.delete("https://restapi.amap.com/v4/geofence/meta?key="+t.getMapKey()+"&gid="+t.gid,{withCredentials:!1}).then(function(e){"成功"===e.data.data.message?(t.operationStatus="围栏删除成功",t.mapView.polygon.visible=!1,t.mapView.polygon.editable=!1,t.disableClk=!1,t.mapView.polygon.path=[]):(t.operationStatus="围栏删除失败："+e.data.data.message,console.log("围栏删除失败："+e.data.data.message))},function(e){t.operationStatus="请求失败，围栏删除失败",console.log("网络请求失败"),console.log("围栏删除失败"),console.log(e)}));t.currentAction=-1}else l()("#loginModal").modal("show")}),this.hasClicked=!1)}},beforeMount:function(){this.getGeoFence()}},g=h,m=(a("a79f"),a("2877")),f=Object(m["a"])(g,i,s,!1,null,"6a551bb4",null);e["default"]=f.exports},"59ad":function(t,e,a){t.exports=a("7be7")},6762:function(t,e,a){"use strict";var i=a("5ca1"),s=a("c366")(!0);i(i.P,"Array",{includes:function(t){return s(this,t,arguments.length>1?arguments[1]:void 0)}}),a("9c6c")("includes")},"6d1d":function(t,e,a){},"7be7":function(t,e,a){a("0a90"),t.exports=a("584a").parseFloat},"8eec":function(t,e,a){},a1ce:function(t,e,a){var i=a("63b6"),s=a("25eb"),o=a("294c"),n=a("e692"),r="["+n+"]",l="​",c=RegExp("^"+r+r+"*"),d=RegExp(r+r+"*$"),u=function(t,e,a){var s={},r=o(function(){return!!n[t]()||l[t]()!=l}),c=s[t]=r?e(p):n[t];a&&(s[a]=c),i(i.P+i.F*r,"String",s)},p=u.trim=function(t,e){return t=String(s(t)),1&e&&(t=t.replace(c,"")),2&e&&(t=t.replace(d,"")),t};t.exports=u},a79f:function(t,e,a){"use strict";var i=a("6d1d"),s=a.n(i);s.a},aae3:function(t,e,a){var i=a("d3f4"),s=a("2d95"),o=a("2b4c")("match");t.exports=function(t){var e;return i(t)&&(void 0!==(e=t[o])?!!e:"RegExp"==s(t))}},ac6a:function(t,e,a){for(var i=a("cadf"),s=a("0d58"),o=a("2aba"),n=a("7726"),r=a("32e9"),l=a("84f2"),c=a("2b4c"),d=c("iterator"),u=c("toStringTag"),p=l.Array,h={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},g=s(h),m=0;m<g.length;m++){var f,b=g[m],v=h[b],C=n[b],w=C&&C.prototype;if(w&&(w[d]||r(w,d,p),w[u]||r(w,u,b),l[b]=p,v))for(f in i)w[f]||o(w,f,i[f],!0)}},d2c8:function(t,e,a){var i=a("aae3"),s=a("be13");t.exports=function(t,e,a){if(i(e))throw TypeError("String#"+a+" doesn't accept regex!");return String(s(t))}},e692:function(t,e){t.exports="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff"}}]);
//# sourceMappingURL=chunk-1f3713f0.cf13ac67.js.map