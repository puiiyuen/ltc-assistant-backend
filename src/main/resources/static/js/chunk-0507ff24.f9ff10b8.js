(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0507ff24"],{"0758":function(t,e,a){},"0a90":function(t,e,a){var n=a("63b6"),s=a("10ff");n(n.G+n.F*(parseFloat!=s),{parseFloat:s})},"10ff":function(t,e,a){var n=a("e53d").parseFloat,s=a("a1ce").trim;t.exports=1/n(a("e692")+"-0")!==-1/0?function(t){var e=s(String(t),3),a=n(e);return 0===a&&"-"==e.charAt(0)?-0:a}:n},2673:function(t,e,a){"use strict";var n=a("0758"),s=a.n(n);s.a},"2fdb":function(t,e,a){"use strict";var n=a("5ca1"),s=a("d2c8"),i="includes";n(n.P+n.F*a("5147")(i),"String",{includes:function(t){return!!~s(this,t,i).indexOf(t,arguments.length>1?arguments[1]:void 0)}})},"4ed9":function(t,e,a){"use strict";var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{attrs:{id:"loginFrame"}},[t._m(0),a("div",{attrs:{id:"login"}},[t.show?a("b-form",{on:{submit:t.onSubmit,reset:t.onReset}},[a("b-form-group",{attrs:{id:"userId",label:"ID:","label-for":"userIdInput"}},[a("b-form-input",{attrs:{id:"userIdInput",type:"text",required:"",placeholder:"输入ID"},model:{value:t.form.userId,callback:function(e){t.$set(t.form,"userId",e)},expression:"form.userId"}})],1),a("b-form-group",{attrs:{id:"password",label:"密码:","label-for":"passwordInput"}},[a("b-form-input",{attrs:{id:"passwordInput",type:"password",required:"",placeholder:"输入密码"},model:{value:t.form.password,callback:function(e){t.$set(t.form,"password",e)},expression:"form.password"}})],1),a("div",{attrs:{id:"loginStatus"}},[a("span",[t._v(t._s(t.loginStatus))])]),a("b-button",{staticClass:"sub-btn",class:{disabled:t.hasClicked},attrs:{type:"submit",variant:"primary",size:"md"}},[t._v("登陆\n        ")]),a("b-button",{staticClass:"sub-btn",class:{disabled:t.hasClicked},attrs:{type:"reset",variant:"danger",size:"md"}},[t._v("重置\n        ")])],1):t._e()],1)])])},s=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"title"}},[a("h3",[t._v("用户登录")])])}],i=a("f499"),o=a.n(i),r=(a("6b54"),a("96cf"),a("3b8d")),l=a("c0d6"),c={data:function(){return{form:{userId:"",password:""},loginStatus:"",show:!0,hasClicked:!1}},methods:{onSubmit:function(t){var e=this;if(t.preventDefault(),!this.hasClicked){var a=/[0-9]+/;a.test(this.form.userId)?(this.hasClicked=!0,this.loginStatus="登陆中...",this.login().then(function(t){100===t?(e.loginStatus="登陆成功",e.fetchData(),e.form.userId="",e.form.password="",e.loginStatus="",e.hasClicked=!1):500===t?(e.loginStatus="账户尚未激活",e.hasClicked=!1,e.$router.push({name:"activate"})):210===t?(e.loginStatus="请求超时，请重试",e.hasClicked=!1):-999===t?(e.loginStatus="服务器开小差了，请重试",e.hasClicked=!1):(e.loginStatus="ID或密码不正确",e.hasClicked=!1)})):this.loginStatus="ID必须为数字"}},onReset:function(t){var e=this;t.preventDefault(),this.hasClicked||(this.form.userId="",this.form.password="",this.loginStatus="",this.show=!1,this.$nextTick(function(){e.show=!0}))},login:function(){var t=Object(r["a"])(regeneratorRuntime.mark(function t(){var e,a;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return e={userId:this.form.userId,password:this.form.password,platform:"CONSOLE"},a=200,t.next=4,this.axios.post(this.getAPI()+"/login",e,{timeout:15e3}).then(function(t){console.log(t.data),a=t.data},function(t){"ECONNABORTED"===t.code&&-1!==t.toString().indexOf("timeout")?a=210:(console.log("post failed"),console.log(t))});case 4:return t.abrupt("return",a);case 5:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),fetchData:function(){this.axios.get(this.getAPI()+"/user").then(function(t){localStorage.setItem("user",o()(t.data)),l["a"].commit("setUser")},function(t){console.log("post failed"),console.log(t)})}}},u=c,d=(a("2673"),a("2877")),p=Object(d["a"])(u,n,s,!1,null,"2f9c4756",null);e["a"]=p.exports},5147:function(t,e,a){var n=a("2b4c")("match");t.exports=function(t){var e=/./;try{"/./"[t](e)}catch(a){try{return e[n]=!1,!"/./"[t](e)}catch(s){}}return!0}},"59ad":function(t,e,a){t.exports=a("7be7")},6762:function(t,e,a){"use strict";var n=a("5ca1"),s=a("c366")(!0);n(n.P,"Array",{includes:function(t){return s(this,t,arguments.length>1?arguments[1]:void 0)}}),a("9c6c")("includes")},"7be7":function(t,e,a){a("0a90"),t.exports=a("584a").parseFloat},a1ce:function(t,e,a){var n=a("63b6"),s=a("25eb"),i=a("294c"),o=a("e692"),r="["+o+"]",l="​",c=RegExp("^"+r+r+"*"),u=RegExp(r+r+"*$"),d=function(t,e,a){var s={},r=i(function(){return!!o[t]()||l[t]()!=l}),c=s[t]=r?e(p):o[t];a&&(s[a]=c),n(n.P+n.F*r,"String",s)},p=d.trim=function(t,e){return t=String(s(t)),1&e&&(t=t.replace(c,"")),2&e&&(t=t.replace(u,"")),t};t.exports=d},aae3:function(t,e,a){var n=a("d3f4"),s=a("2d95"),i=a("2b4c")("match");t.exports=function(t){var e;return n(t)&&(void 0!==(e=t[i])?!!e:"RegExp"==s(t))}},ca5e:function(t,e,a){},d2c8:function(t,e,a){var n=a("aae3"),s=a("be13");t.exports=function(t,e,a){if(n(e))throw TypeError("String#"+a+" doesn't accept regex!");return String(s(t))}},d6a3:function(t,e,a){"use strict";var n=a("ca5e"),s=a.n(n);s.a},e692:function(t,e){t.exports="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff"},f53d:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[t._m(0),t._m(1),a("div",{attrs:{id:"geo-fence"}},[a("div",{staticClass:"row"},[a("div",{staticClass:"col-11"},[a("div",{staticClass:"amap-wrapper"},[a("el-amap",{attrs:{vid:"amap-geo-fence",plugin:t.mapView.plugin,center:t.mapView.mapCenter,zoom:t.mapView.zoom,"amap-manager":t.amapManager}},[t._l(t.mapView.markers,function(t){return a("el-amap-marker",{attrs:{position:t}})}),a("el-amap-polygon",{ref:"polygon_0",attrs:{path:t.mapView.polygon.path,editable:t.mapView.polygon.editable,events:t.mapView.polygon.events,draggable:t.mapView.polygon.editable,fillOpacity:"0.3",fillColor:"blue",strokeOpacity:"0.6",strokeColor:"pink",zIndex:"50",visible:t.mapView.polygon.visible}})],2)],1)]),a("div",{staticClass:"col-1"})])]),a("div",{staticClass:"row"},[a("div",{staticClass:"col-4"},[a("div",{staticClass:"map-toolbar"},[a("button",{staticClass:"btn btn-info",attrs:{type:"button"},on:{click:t.getGeoFence}},[t._v("刷新围栏")])])]),a("div",{staticClass:"col-4"},[a("div",{staticClass:"status-info"},[t._v(t._s(t.operationStatus))])])]),a("div",{staticClass:"modal fade",attrs:{id:"loginModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true"}},[a("div",{staticClass:"modal-dialog modal-dialog-centered modal-md",attrs:{role:"document"}},[a("div",{staticClass:"modal-content"},[t._m(2),a("div",{staticClass:"modal-body",attrs:{id:"loginModalBody"}},[a("LoginModal")],1)])])])])},s=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"row"},[a("div",{staticClass:"col-12"},[a("div",{attrs:{id:"panel-title"}},[a("h4",[a("strong",[t._v("安全中心")])])])])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("label",{attrs:{for:"geo-fence"}},[a("strong",[t._v("电子围栏")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"modal-header"},[a("h5",{staticClass:"modal-title",attrs:{id:"loginModalLabel"}},[t._v("会话超时")]),a("button",{staticClass:"close",attrs:{type:"button","data-dismiss":"modal","aria-label":"Close"}},[a("span",{attrs:{"aria-hidden":"true"}},[t._v("×")])])])}],i=(a("6762"),a("2fdb"),a("59ad")),o=a.n(i),r=a("1157"),l=a.n(r),c=a("4ed9"),u=a("8f9b"),d=a.n(u),p=new d.a.AMapManager,f={name:"panel-security",components:{LoginModal:c["a"]},data:function(){return{amapManager:p,mapView:{zoom:14,markers:[],mapCenter:[113.874908,22.902537],lng:0,lat:0,plugin:[{pName:"Geolocation",events:{}},{pName:"OverView",isOpen:!0},{pName:"PolyEditor"}],polygon:{visible:!1,editable:!1,path:[]}},operationStatus:""}},computed:{isOnline:function(){return this.$store.getters.getOnline}},watch:{isOnline:function(){this.$store.getters.getOnline&&(l()("#loginModal").modal("hide"),this.getGeoFence())}},methods:{setMapCenter:function(t){this.mapView.mapCenter=[o()(t.substring(0,t.indexOf(","))),o()(t.substring(t.indexOf(",")+1))]},setPolygonPath:function(t){this.mapView.polygon.path=[];var e=[];do{e.push(o()(t.substring(0,t.indexOf(",")))),t=t.substring(t.indexOf(",")+1),t.includes(";")?(e.push(o()(t.substring(0,t.indexOf(";")))),t=t.substring(t.indexOf(";")+1)):e.push(o()(t)),this.mapView.polygon.path.push(e),e=[]}while(t.includes(","))},getGeoFence:function(){var t=this;this.checkSession().then(function(e){e?(t.operationStatus="获取围栏中...",t.axios.get("https://restapi.amap.com/v4/geofence/meta?key="+t.getMapKey(),{withCredentials:!1}).then(function(e){0===e.data.data.total_record?t.operationStatus="暂无围栏,请前往安全设置添加":e.data.data.total_record>0?(t.mapView.polygon.visible=!0,t.setPolygonPath(e.data.data.rs_list[0].points),t.setMapCenter(e.data.data.rs_list[0].center),t.mapView.markers=[],t.axios.get(t.getAPI()+"/security/fence-monitor").then(function(e){for(var a=0;a<e.data.length;a++){var n=[];n.push(e.data[a].longitude),n.push(e.data[a].latitude),t.mapView.markers.push(n)}},function(t){console.log("get user location marker failed"),console.log(t)}),t.operationStatus="围栏获取成功",p.getMap().setFitView()):(console.log("获取失败："+e.data.data.message),console.log(e))},function(e){t.operationStatus="请求获取围栏失败",console.log("get geofence failed"),console.log(e)})):l()("#loginModal").modal("show")})}},beforeMount:function(){this.getGeoFence()}},m=f,g=(a("d6a3"),a("2877")),h=Object(g["a"])(m,n,s,!1,null,"fbf1524c",null);e["default"]=h.exports}}]);
//# sourceMappingURL=chunk-0507ff24.f9ff10b8.js.map